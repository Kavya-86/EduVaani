<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Reaction Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #6dd5ed, #2193b0);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background 1s ease-in-out;
        }
        .element-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: grab;
        }
        .element-card:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .element-card:active {
            cursor: grabbing;
            transform: scale(1.05);
        }
        .lab-bench {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M0 0h100v2H0zM0 10h100v2H0zM0 20h100v2H0zM0 30h100v2H0zM0 40h100v2H0zM0 50h100v2H0zM0 60h100v2H0zM0 70h100v2H0zM0 80h100v2H0zM0 90h100v2H0z" fill-opacity="0.05" fill="%23000000"/></svg>');
            background-size: 50px 50px;
        }
        #test-tube-dropzone.drag-over {
            border: 4px dashed #f59e0b;
            transform: scale(1.05);
        }
        #test-tube-liquid {
            transition: height 0.5s ease-in-out, background-color 0.5s ease-in-out;
        }
        @keyframes bubble {
            0% { transform: translateY(0) scale(0); opacity: 1; }
            100% { transform: translateY(-150px) scale(1.5); opacity: 0; }
        }
        .bubble {
            position: absolute;
            bottom: 5px;
            width: 10px;
            height: 10px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            animation: bubble 2s infinite;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .animate-shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .difficulty-btn {
            transition: all 0.3s ease;
        }
        .difficulty-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- Start Screen -->
    <div id="start-screen" class="w-full max-w-2xl mx-auto p-8 bg-white/50 rounded-2xl shadow-2xl backdrop-blur-sm border border-white/30 text-center">
        <h1 class="text-5xl font-bold text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.4);">Welcome to the Lab!</h1>
        <p class="text-white/80 text-xl mt-2 mb-8">Select a difficulty to begin</p>
        <div class="flex flex-col md:flex-row justify-center gap-6">
            <button data-difficulty="easy" class="difficulty-btn text-2xl font-bold text-white bg-green-500 py-4 px-8 rounded-xl shadow-lg">Easy</button>
            <button data-difficulty="medium" class="difficulty-btn text-2xl font-bold text-white bg-yellow-500 py-4 px-8 rounded-xl shadow-lg">Medium</button>
            <button data-difficulty="hard" class="difficulty-btn text-2xl font-bold text-white bg-red-500 py-4 px-8 rounded-xl shadow-lg">Hard</button>
        </div>
        <button id="quit-game-btn" class="mt-8 text-lg font-bold text-white/70 bg-gray-700/50 py-2 px-6 rounded-lg hover:text-white hover:bg-gray-700/80 transition">Quit Game</button>
    </div>

    <div id="game-container" class="w-full max-w-7xl mx-auto p-4 md:p-6 bg-white/50 rounded-2xl shadow-2xl backdrop-blur-sm border border-white/30 hidden">
       
        <header class="text-center mb-4">
            <h1 class="text-4xl md:text-5xl font-bold text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.4);">Chemical Reaction Lab</h1>
            <p class="text-white/80 text-lg">Mix the elements and watch the reactions!</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
           
            <div class="lg:col-span-1 bg-gray-200/50 p-4 rounded-xl shadow-inner lab-bench">
                <h2 class="text-2xl font-bold mb-4 text-center">Element Shelf</h2>
                <div id="element-shelf" class="grid grid-cols-3 sm:grid-cols-4 gap-3"></div>
            </div>

            <div class="lg:col-span-1 flex flex-col items-center justify-between bg-gray-200/50 p-4 rounded-xl shadow-inner lab-bench">
                <h2 class="text-2xl font-bold mb-2 text-center">Reaction Chamber</h2>
                <div id="test-tube-dropzone" class="w-28 h-80 bg-gray-300/50 rounded-t-3xl rounded-b-lg border-4 border-gray-400 relative flex items-end transition-all duration-300">
                    <div id="test-tube-liquid" class="w-full bg-blue-300/70 rounded-b-md" style="height: 0%;"></div>
                    <div id="reaction-animation-container" class="absolute inset-0 overflow-hidden rounded-b-lg"></div>
                </div>
                <div id="beaker-contents" class="mt-2 text-center font-semibold text-lg min-h-[30px]"></div>
                <div class="flex flex-wrap justify-center gap-2 mt-4">
                    <button id="react-btn" class="px-4 py-2 bg-green-500 text-white font-bold rounded-lg shadow-md hover:bg-green-600 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed">React!</button>
                    <button id="hint-btn" class="px-4 py-2 bg-yellow-500 text-white font-bold rounded-lg shadow-md hover:bg-yellow-600 transition-transform transform hover:scale-105">Hint (-10)</button>
                    <button id="reset-btn" class="px-4 py-2 bg-red-500 text-white font-bold rounded-lg shadow-md hover:bg-red-600 transition-transform transform hover:scale-105">Reset</button>
                    <button id="quit-btn" class="px-4 py-2 bg-gray-600 text-white font-bold rounded-lg shadow-md hover:bg-gray-700 transition-transform transform hover:scale-105">Main Menu</button>
                </div>
            </div>

            <div class="lg:col-span-1 bg-gray-200/50 p-4 rounded-xl shadow-inner lab-bench">
                <div class="flex justify-between items-center mb-4 text-white bg-black/30 p-2 rounded-lg shadow-md">
                    <div class="font-bold text-lg">Score: <span id="score-display">0</span></div>
                    <div class="font-bold text-lg">Timer: <span id="timer-display">1:00</span></div>
                </div>
                <div class="text-center">
                    <h2 class="text-2xl font-bold">Today's Mission</h2>
                    <p id="mission-title" class="text-xl text-indigo-700 font-semibold"></p>
                    <p id="mission-description" class="text-gray-600 mt-1"></p>
                </div>
                <hr class="my-4 border-gray-400">
                <div>
                    <h3 class="text-xl font-bold text-center">Your Equation:</h3>
                    <div id="equation-display" class="mt-2 text-2xl font-mono bg-white/70 p-3 rounded-lg text-center min-h-[50px] flex items-center justify-center"></div>
                </div>
                <div id="info-panel" class="mt-4 p-3 bg-white/80 rounded-lg hidden opacity-0 transition-all duration-500 ease-in-out transform -translate-y-4">
                    <!-- Info will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl p-8 text-center max-w-md w-full transform transition-transform scale-95">
            <h2 id="modal-title" class="text-4xl font-bold mb-4"></h2>
            <p id="modal-feedback" class="text-lg text-gray-700 mb-6"></p>
            <button id="modal-btn" class="w-full px-6 py-3 bg-blue-500 text-white font-bold text-xl rounded-lg shadow-md hover:bg-blue-600 transition-transform transform hover:scale-105"></button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ELEMENT_DATA = {
                'H': { name: 'Hydrogen', color: '#E0F7FA' }, 'O': { name: 'Oxygen', color: '#FFCDD2' },
                'Na': { name: 'Sodium', color: '#FFF9C4' }, 'Cl': { name: 'Chlorine', color: '#C8E6C9' },
                'C': { name: 'Carbon', color: '#BDBDBD' }, 'Fe': { name: 'Iron', color: '#FFCCBC' },
                'S': { name: 'Sulfur', color: '#FFF59D' }, 'Mg': { name: 'Magnesium', color: '#E0E0E0' },
                'N': { name: 'Nitrogen', color: '#BBDEFB' }, 'Al': { name: 'Aluminum', color: '#CFD8DC'},
                'P': { name: 'Phosphorus', color: '#FFECB3' }, 'K': { name: 'Potassium', color: '#D1C4E9' },
                'Ca': { name: 'Calcium', color: '#FFCC80' }, 'Cr': { name: 'Chromium', color: '#B2DFDB' },
                'Ag': { name: 'Silver', color: '#EEEEEE' }
            };

            const levels = {
                easy: [
                    {
                        level: 1, title: "Create Water", description: "Combine Hydrogen (H) and Oxygen (O).",
                        reactants: { 'H': 2, 'O': 1 }, productFormula: "H‚ÇÇO", available: ['H', 'O', 'Na'],
                        feedback: "Well done! You have created water (H‚ÇÇO).", productColor: '#a7d7f9',
                        background: 'linear-gradient(135deg, #6dd5ed, #2193b0)',
                        info: "<h3>Water is Life!</h3><p>Water (H‚ÇÇO) is one of the most essential things for life on Earth.</p>"
                    },
                    {
                        level: 2, title: "Create Salt", description: "Combine Sodium (Na) and Chlorine (Cl).",
                        reactants: { 'Na': 1, 'Cl': 1 }, productFormula: "NaCl", available: ['Na', 'Cl', 'H', 'O'],
                        feedback: "Very good! You've created common salt (NaCl).", productColor: '#f7f5e6',
                        background: 'linear-gradient(135deg, #fdfbfb, #ebedee)',
                        info: "<h3>Salt to Taste!</h3><p>Sodium Chloride (NaCl) is an important part of our food.</p>"
                    },
                    {
                        level: 3, title: "Create Carbon Dioxide", description: "Combine Carbon (C) and Oxygen (O).",
                        reactants: { 'C': 1, 'O': 2 }, productFormula: "CO‚ÇÇ", available: ['C', 'O', 'H', 'Fe'],
                        feedback: "Amazing! You've created Carbon Dioxide (CO‚ÇÇ) gas.", productColor: '#d1d1d1',
                        background: 'linear-gradient(135deg, #BBD2C5, #536976)',
                        info: "<h3>Essential Gas!</h3><p>Plants use Carbon Dioxide (CO‚ÇÇ) for photosynthesis.</p>"
                    }
                ],
                medium: [
                    {
                        level: 1, title: "Create Methane", description: "Combine Carbon (C) and Hydrogen (H) in the correct ratio.",
                        reactants: { 'C': 1, 'H': 4 }, productFormula: "CH‚ÇÑ", available: ['C', 'H', 'O', 'N'],
                        feedback: "Great! Methane is a primary component of natural gas.",
                        productColor: '#E0F2F1', background: 'linear-gradient(135deg, #009688, #4DB6AC)',
                        info: "<h3>Greenhouse Gas!</h3><p>Methane (CH‚ÇÑ) is a powerful greenhouse gas and is used as a fuel.</p>"
                    },
                    {
                        level: 2, title: "Create Nitric Acid", description: "Balance Hydrogen (H), Nitrogen (N), and Oxygen (O).",
                        reactants: { 'H': 1, 'N': 1, 'O': 3 }, productFormula: "HNO‚ÇÉ", available: ['H', 'N', 'O', 'S'],
                        feedback: "Excellent! You have created Nitric Acid, a strong acid.",
                        productColor: '#FFEBEE', background: 'linear-gradient(135deg, #F44336, #E57373)',
                        info: "<h3>Strong Acid!</h3><p>Nitric Acid (HNO‚ÇÉ) is used in many things, from rocket fuel to fertilizers.</p>"
                    },
                    {
                        level: 3, title: "Create Silver Chloride", description: "Combine Silver (Ag) and Chlorine (Cl).",
                        reactants: { 'Ag': 1, 'Cl': 1 }, productFormula: "AgCl", available: ['Ag', 'Cl', 'Na', 'O'],
                        feedback: "Correct! Silver Chloride turns black in sunlight.",
                        productColor: '#FAFAFA', background: 'linear-gradient(135deg, #9E9E9E, #E0E0E0)',
                        info: "<h3>Used in Photography!</h3><p>Silver Chloride (AgCl) is light-sensitive, which is why it was used in traditional photography.</p>"
                    }
                ],
                hard: [
                     {
                        level: 1, title: "Create Calcium Phosphate", description: "Balance Calcium (Ca), Phosphorus (P), and Oxygen (O).",
                        reactants: { 'Ca': 3, 'P': 2, 'O': 8 }, productFormula: "Ca‚ÇÉ(PO‚ÇÑ)‚ÇÇ", available: ['Ca', 'P', 'O', 'H'],
                        feedback: "Fantastic! This is the main component of our bones.",
                        productColor: '#F5F5F5', background: 'linear-gradient(135deg, #795548, #A1887F)',
                        info: "<h3>Strength of Bones!</h3><p>Calcium Phosphate (Ca‚ÇÉ(PO‚ÇÑ)‚ÇÇ) gives strength to our teeth and bones.</p>"
                    },
                    {
                        level: 2, title: "Create Potassium Dichromate", description: "Balance Potassium (K), Chromium (Cr), and Oxygen (O).",
                        reactants: { 'K': 2, 'Cr': 2, 'O': 7 }, productFormula: "K‚ÇÇCr‚ÇÇO‚Çá", available: ['K', 'Cr', 'O', 'Na'],
                        feedback: "Brilliant! It's an important oxidizing agent used in labs.",
                        productColor: '#FFAB40', background: 'linear-gradient(135deg, #FF6F00, #FFB300)',
                        info: "<h3>Lab Agent!</h3><p>Potassium Dichromate (K‚ÇÇCr‚ÇÇO‚Çá) is a bright orange, crystalline solid used in chemical analysis.</p>"
                    },
                    {
                        level: 3, title: "Create Glucose", description: "Balance Carbon (C), Hydrogen (H), and Oxygen (O).",
                        reactants: { 'C': 6, 'H': 12, 'O': 6 }, productFormula: "C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ", available: ['C', 'H', 'O', 'N'],
                        feedback: "Masterstroke! You created Glucose, the source of energy for life.",
                        productColor: '#F1F8E9', background: 'linear-gradient(135deg, #689F38, #AED581)',
                        info: "<h3>Source of Energy!</h3><p>Plants produce Glucose (C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ) during photosynthesis, which is the primary source of energy for almost all life.</p>"
                    }
                ]
            };

            let currentLevel = 0, score = 0, beakerContents = {}, draggedElement = null, timerInterval = null, chosenLevels = [];

            const [startScreen, gameContainer, elementShelf, missionTitle, missionDescription, equationDisplay, reactBtn, resetBtn, dropzone, liquid, beakerContentsDisplay, resultModal, modalContent, modalTitle, modalFeedback, modalBtn, scoreDisplay, timerDisplay, hintBtn, infoPanel, reactionAnimationContainer, quitBtn] = [
                'start-screen', 'game-container', 'element-shelf', 'mission-title', 'mission-description', 'equation-display', 'react-btn', 'reset-btn', 'test-tube-dropzone', 'test-tube-liquid', 'beaker-contents', 'result-modal', 'modal-content', 'modal-title', 'modal-feedback', 'modal-btn', 'score-display', 'timer-display', 'hint-btn', 'info-panel', 'reaction-animation-container', 'quit-btn'
            ].map(id => document.getElementById(id));
           
            const quitGameBtn = document.getElementById('quit-game-btn');

            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const difficulty = e.target.dataset.difficulty;
                    chosenLevels = levels[difficulty];
                    startGame();
                });
            });

            quitGameBtn.addEventListener('click', () => {
                startScreen.innerHTML = `
                    <h1 class="text-5xl font-bold text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.4);">Thanks for Playing!</h1>
                    <p class="text-white/80 text-xl mt-2">You can now close this tab.</p>
                `;
            });

            function startGame() {
                startScreen.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                currentLevel = 0;
                score = 0;
                scoreDisplay.innerText = score;
                loadLevel(currentLevel);
            }

            function createSubscript(formula) { return formula.replace(/(\d+)/g, '<sub>$1</sub>').replace(/\(/g, '<sub>(').replace(/\)/g, ')</sub>'); }

            function loadLevel(levelIndex) {
                if (levelIndex >= chosenLevels.length) { showFinalWin(); return; }
                const levelData = chosenLevels[levelIndex];
                document.body.style.background = levelData.background;
                missionTitle.innerHTML = createSubscript(levelData.title);
                missionDescription.innerText = levelData.description;
               
                elementShelf.innerHTML = '';
                levelData.available.forEach(symbol => {
                    const elData = ELEMENT_DATA[symbol];
                    const card = document.createElement('div');
                    card.className = 'element-card p-2 rounded-lg text-center shadow-md';
                    card.style.backgroundColor = elData.color;
                    card.draggable = true;
                    card.dataset.element = symbol;
                    card.innerHTML = `<div class="font-bold text-2xl">${symbol}</div><div class="text-xs">${elData.name}</div>`;
                    elementShelf.appendChild(card);
                });
               
                resetBeaker();
                addDragListeners();
                hintBtn.disabled = false;
                infoPanel.classList.add('hidden', 'opacity-0', '-translate-y-4');
                infoPanel.innerHTML = '';
                startTimer();
            }

            function startTimer() {
                clearInterval(timerInterval);
                let timeLeft = 60;
                timerDisplay.innerText = '1:00';
                timerInterval = setInterval(() => {
                    timeLeft--;
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    timerDisplay.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        handleTimeUp();
                    }
                }, 1000);
            }

            function handleTimeUp() {
                showModal('timeup', "Time's Up!", "Time's Up! Please try this level again.", "Restart Level");
            }

            function resetBeaker() {
                beakerContents = {};
                updateEquation();
                updateBeakerVisual(true);
                reactBtn.disabled = true;
            }

            function updateEquation() {
                const reactants = Object.entries(beakerContents).map(([el, count]) => (count > 1 ? count : '') + el).join(' + ');
                equationDisplay.innerHTML = reactants ? createSubscript(reactants) : '?';
                beakerContentsDisplay.innerHTML = reactants ? createSubscript(reactants) : '';
                reactBtn.disabled = Object.keys(beakerContents).length === 0;
            }

            function updateBeakerVisual(isReset = false) {
                const totalElements = Object.values(beakerContents).reduce((a, b) => a + b, 0);
                const fillPercentage = Math.min(100, (totalElements / 25) * 100); // Adjusted for higher atom counts in hard levels
                liquid.style.height = `${fillPercentage}%`;
                liquid.style.backgroundColor = isReset ? '' : '#60a5fa';
            }
           
            function addDragListeners() {
                document.querySelectorAll('.element-card').forEach(el => {
                    el.addEventListener('dragstart', e => {
                        draggedElement = e.target.closest('.element-card').dataset.element;
                        e.target.closest('.element-card').classList.add('opacity-50');
                    });
                    el.addEventListener('dragend', e => e.target.closest('.element-card').classList.remove('opacity-50'));
                });
            }

            dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('drag-over'); });
            dropzone.addEventListener('dragleave', () => dropzone.classList.remove('drag-over'));
            dropzone.addEventListener('drop', e => {
                e.preventDefault();
                dropzone.classList.remove('drag-over');
                if (draggedElement) {
                    beakerContents[draggedElement] = (beakerContents[draggedElement] || 0) + 1;
                    updateEquation();
                    updateBeakerVisual();
                }
            });
           
            quitBtn.addEventListener('click', () => {
                clearInterval(timerInterval);
                gameContainer.classList.add('hidden');
                startScreen.classList.remove('hidden');
                 document.body.style.background = 'linear-gradient(135deg, #6dd5ed, #2193b0)';
            });

            hintBtn.addEventListener('click', () => {
                score = Math.max(0, score - 10);
                scoreDisplay.innerText = score;
                hintBtn.disabled = true;
                const levelData = chosenLevels[currentLevel];
                const hintText = Object.entries(levelData.reactants).map(([el, count]) => `${ELEMENT_DATA[el].name} (${el}): ${count} atom(s)`).join('<br>');
                showModal('hint', 'Hint!', `For the correct reaction, you need:<br><br>${hintText}`, 'Got It!');
            });

            reactBtn.addEventListener('click', () => {
                const levelData = chosenLevels[currentLevel];
                let correct = Object.keys(levelData.reactants).length === Object.keys(beakerContents).length;
                if(correct) {
                    for (const el in levelData.reactants) {
                        if (levelData.reactants[el] !== beakerContents[el]) {
                            correct = false;
                            break;
                        }
                    }
                }
                correct ? handleSuccess() : handleFailure();
            });
           
            resetBtn.addEventListener('click', resetBeaker);

            function playReactionAnimation(type) {
                reactionAnimationContainer.innerHTML = '';
                const levelData = chosenLevels[currentLevel];
                if(type === 'success') {
                    liquid.style.backgroundColor = levelData.productColor;
                    for(let i=0; i < 20; i++) {
                        const bubble = document.createElement('div');
                        bubble.className = 'bubble';
                        bubble.style.left = `${Math.random() * 90}%`;
                        bubble.style.animationDelay = `${Math.random() * 2}s`;
                        bubble.style.animationDuration = `${1 + Math.random() * 2}s`;
                        reactionAnimationContainer.appendChild(bubble);
                    }
                } else if (type === 'failure') {
                    liquid.style.backgroundColor = '#f87171';
                    dropzone.classList.add('animate-shake');
                    setTimeout(() => {
                       dropzone.classList.remove('animate-shake');
                       updateBeakerVisual();
                    }, 500);
                }
            }

            function handleSuccess() {
                clearInterval(timerInterval);
                playReactionAnimation('success');
                score += 10;
                scoreDisplay.innerText = score;

                const levelData = chosenLevels[currentLevel];
                const reactants = Object.entries(levelData.reactants).map(([el, count]) => (count > 1 ? count : '') + el).join(' + ');
                equationDisplay.innerHTML = `${createSubscript(reactants)} ‚Üí ${createSubscript(levelData.productFormula)}`;
               
                infoPanel.innerHTML = levelData.info;
                infoPanel.classList.remove('hidden');
                setTimeout(() => infoPanel.classList.remove('opacity-0', '-translate-y-4'), 50);

                setTimeout(() => {
                   showModal('success', "Reaction Successful!", levelData.feedback, currentLevel === chosenLevels.length - 1 ? "Play Again" : "Next Level!");
                }, 2000);
            }

            function handleFailure() {
                playReactionAnimation('failure');
                setTimeout(() => {
                    showModal('failure', "Something Went Wrong!", "Oops! That reaction didn't work. Try again!", "Try Again");
                }, 500);
            }
           
            function showModal(type, title, feedback, btnText) {
                resultModal.classList.remove('hidden');
                setTimeout(() => {
                    resultModal.style.opacity = '1';
                    modalContent.style.transform = 'scale(1)';
                }, 10);

                modalTitle.innerText = title;
                modalTitle.className = "text-4xl font-bold mb-4 ";
                if(type === 'success') modalTitle.classList.add('text-green-500');
                else if(type === 'failure' || type === 'timeup') modalTitle.classList.add('text-red-500');
                else modalTitle.classList.add('text-yellow-500');

                modalFeedback.innerHTML = createSubscript(feedback);
                modalBtn.innerText = btnText;

                modalBtn.onclick = () => {
                    closeModal();
                    if(type === 'success') {
                        if(btnText === 'Play Again'){
                            quitBtn.click();
                        } else {
                            currentLevel++;
                            loadLevel(currentLevel);
                        }
                    } else if (type === 'failure') {
                        resetBeaker();
                    } else if (type === 'timeup') {
                        loadLevel(currentLevel);
                    }
                };
            }

            function closeModal() {
                 resultModal.style.opacity = '0';
                 modalContent.style.transform = 'scale(0.95)';
                 setTimeout(() => resultModal.classList.add('hidden'), 300);
            }
           
            function showFinalWin() {
                missionTitle.innerText = "Game Complete!";
                missionDescription.innerHTML = `You have completed all the reactions! <br>Your Final Score: ${score}`;
                elementShelf.innerHTML = '<p class="col-span-full text-center text-5xl p-8">üèÜ</p>';
                equationDisplay.innerHTML = '‚ú® You Win! ‚ú®';
                reactBtn.disabled = true;
                resetBtn.disabled = true;
                hintBtn.disabled = true;
                infoPanel.classList.add('hidden');
                quitBtn.innerText = 'Play Again';
            }

        });
    </script>
</body>
</html>