<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometric Shapes in Space</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Baloo 2', cursive;
            background: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Animated space background */
        .space-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #020107, #0d0d2b, #1f1f54);
            overflow: hidden;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
            box-shadow: 0 0 8px #fff;
        }

        @keyframes twinkle {
            0% { opacity: 0.4; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1.1); }
        }

        .space-emoji {
            position: absolute;
            animation: float-around linear infinite;
            opacity: 0.7; /* Increased opacity for better glow */
            user-select: none;
        }

        @keyframes float-around {
            0% { transform: translateY(0px) translateX(0px) rotate(0deg); }
            25% { transform: translateY(15px) translateX(-15px) rotate(45deg); }
            50% { transform: translateY(0px) translateX(15px) rotate(90deg); }
            75% { transform: translateY(-15px) translateX(-15px) rotate(135deg); }
            100% { transform: translateY(0px) translateX(0px) rotate(180deg); }
        }
        
        /* Base Rocket Style - Smaller Size */
        .rocket {
            position: absolute;
            width: 20px; /* Reduced from 25px */
            height: 48px; /* Reduced from 60px */
            animation: fly-across linear infinite;
            filter: drop-shadow(0 0 6px #fff);
            display: flex;
            justify-content: center;
        }
        .rocket .body {
            width: 100%;
            height: 100%;
            background: #d0d0d0;
            border-radius: 50% 50% 5px 5px;
            position: relative;
        }
        .rocket .window {
            position: absolute;
            top: 12px; /* Adjusted */
            left: 50%;
            transform: translateX(-50%);
            width: 10px; /* Adjusted */
            height: 10px; /* Adjusted */
            background: #87ceeb;
            border-radius: 50%;
            border: 2px solid #555;
        }
        .rocket .fin {
            position: absolute;
            bottom: 4px; /* Adjusted */
            width: 0;
            height: 0;
            border-left: 6px solid transparent; /* Adjusted */
            border-right: 6px solid transparent; /* Adjusted */
            border-bottom: 12px solid #ff4d4d; /* Adjusted */
        }
        .rocket .fin.left { left: -6px; } /* Adjusted */
        .rocket .fin.right { right: -6px; } /* Adjusted */

        .rocket .flame {
            position: absolute;
            bottom: -15px; /* Adjusted */
            left: 50%;
            width: 14px; /* Adjusted */
            height: 20px; /* Adjusted */
            background: radial-gradient(circle, white, yellow, orange);
            border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
            animation: flicker 0.1s linear infinite;
        }
        
        /* Style 2 - Red Rocket */
        .rocket.style-2 .body {
            background: #c0392b;
        }
        .rocket.style-2 .fin {
            border-bottom-color: #f1c40f;
        }
        
        /* Style 3 - Blue Rocket */
        .rocket.style-3 .body {
            background: #2980b9;
        }
        .rocket.style-3 .fin {
            border-bottom-color: #bdc3c7;
        }

        @keyframes flicker {
            0% { transform: translateX(-50%) scale(1, 1.1); opacity: 1; }
            50% { transform: translateX(-50%) scale(0.9, 1); opacity: 0.8; }
            100% { transform: translateX(-50%) scale(1, 1.1); opacity: 1; }
        }
        
        .rocket.ltr {
            left: -50px;
            animation-name: fly-across-ltr;
        }
        .rocket.rtl {
            right: -50px;
            animation-name: fly-across-rtl;
        }

        @keyframes fly-across-ltr {
            from { transform: translate(-100px, 0) rotate(15deg); }
            to { transform: translate(100vw, 50px) rotate(15deg); }
        }
        @keyframes fly-across-rtl {
            from { transform: translate(100px, 0) rotate(-15deg); }
            to { transform: translate(-100vw, -50px) rotate(-15deg); }
        }


        #game-container {
            width: 95%;
            max-width: 800px;
            max-height: 95vh; /* Added this to prevent vertical overflow */
            aspect-ratio: 16 / 10;
            background: rgba(10, 5, 40, 0.45);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(127, 0, 255, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        #info-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto 1fr;
            align-items: center;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
        }
        
        #quit-button {
            padding: 8px 18px;
            font-size: 0.9em;
            font-family: 'Baloo 2', cursive;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ffa5a5);
            color: white;
            cursor: pointer;
            box-shadow: 0 0 15px #ff6b6b;
            transition: transform 0.2s;
            justify-self: center;
        }

        #quit-button:hover {
            transform: scale(1.05);
        }

        #score-display, #lives-display, #level-display, #timer-display {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #score-display { justify-self: start; }
        #lives-display { justify-self: end; }


        #lives-display span {
            margin-left: 10px;
            color: #ff4d4d;
            text-shadow: 0 0 5px #ff0000;
        }

        #game-canvas {
            flex-grow: 1;
            cursor: grab;
        }

        #game-canvas:active {
            cursor: grabbing;
        }

        #modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            z-index: 10;
        }
        
        #modal h1 {
            font-size: 3em;
            margin: 0;
            color: #4dff91;
            text-shadow: 0 0 15px #4dff91;
        }
        
        #modal p {
            font-size: 1.5em;
            margin: 10px 20px 30px 20px;
        }
        
        #modal-button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .modal-button {
            padding: 15px 30px;
            font-size: 1.5em;
            font-family: 'Baloo 2', cursive;
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        #start-game-btn { background: linear-gradient(45deg, #47d1ff, #94e3ff); box-shadow: 0 0 20px #47d1ff; }
        #next-level-btn { background: linear-gradient(45deg, #ffc847, #ffd98c); box-shadow: 0 0 20px #ffc847; }
        #play-again-btn { background: linear-gradient(45deg, #4dff91, #a1ffc4); box-shadow: 0 0 20px #4dff91; }

        .modal-button:hover {
            transform: scale(1.1);
        }
        
        /* Celebration Animation Styles */
        #celebration-container {
            display: none;
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 11;
            overflow: hidden;
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: sparkle-anim 1.5s ease-out forwards;
        }

        @keyframes sparkle-anim {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y)) scale(0);
                opacity: 0;
            }
        }

        .pinata {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 120px;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #1dd1a1);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform: translate(-50%, -50%);
            animation: pinata-swing 1s ease-in-out infinite alternate;
        }

        @keyframes pinata-swing {
            from { transform: translate(-50%, -50%) rotate(-10deg); }
            to { transform: translate(-50%, -50%) rotate(10deg); }
        }

        .pinata-fragment {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            animation: fragment-anim 2s cubic-bezier(0.1, 0.8, 0.7, 1) forwards;
        }

        @keyframes fragment-anim {
            0% {
                transform: translate(-50%, -50%) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y) + 400px)) rotate(var(--rot)) scale(0);
                opacity: 0;
            }
        }


    </style>
</head>
<body>

    <div class="space-background">
        <div id="stars-container"></div>
        <div id="emojis-container"></div>
        <div id="rockets-container"></div>
    </div>

    <div id="game-container">
        <div id="info-bar">
            <div id="score-display">Score: 0</div>
            <div id="level-display">Level: -</div>
            <div id="timer-display">Time: --</div>
            <button id="quit-button" style="display: none;">Quit</button>
            <div id="lives-display">Lives: <span>&hearts;&hearts;&hearts;</span></div>
        </div>
        <canvas id="game-canvas"></canvas>

        <div id="modal">
             <!-- Content is generated by JS -->
        </div>

        <div id="celebration-container"></div>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const livesDisplay = document.getElementById('lives-display').querySelector('span');
        const levelDisplay = document.getElementById('level-display');
        const timerDisplay = document.getElementById('timer-display');
        const modal = document.getElementById('modal');
        const quitButton = document.getElementById('quit-button');
        const celebrationContainer = document.getElementById('celebration-container');
        
        let totalScore = 0, levelScore = 0, lives = 3, shapes = [], bins = [];
        let draggingShape = null, offsetX, offsetY;
        let gameActive = false, currentLevel;
        let feedback = null;
        let timerInterval = null, timeLeft = 0;

        const COLORS = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'];
        
        const ALL_SHAPE_FACTS = {
            circle: "A circle is perfectly round and has no corners.",
            square: "A square has four equal sides and four right angles.",
            triangle: "A triangle has three sides and three corners.",
            rectangle: "A rectangle has four sides with opposite sides being equal.",
            star: "This is a star! It has points, just like the ones in the sky.",
            pentagon: "A pentagon is a shape with five straight sides.",
            hexagon: "A hexagon has six sides. Think of a honeycomb!",
            rhombus: "A rhombus is like a tilted square, with four equal sides.",
            oval: "An oval is like a stretched circle, similar to an egg.",
            heart: "A heart shape is a symbol of love!"
        };

        const difficultySettings = {
            easy: {
                name: 'Easy',
                shapes: ['circle', 'square', 'triangle', 'rectangle'],
                speed: 0.8,
                maxShapesOnScreen: 5,
                scoreTarget: 100,
                timeLimit: 60
            },
            medium: {
                name: 'Medium',
                shapes: ['circle', 'square', 'triangle', 'star', 'pentagon', 'oval'],
                speed: 1.2,
                maxShapesOnScreen: 5,
                scoreTarget: 150,
                timeLimit: 75
            },
            hard: {
                name: 'Hard',
                shapes: ['rectangle', 'star', 'pentagon', 'hexagon', 'rhombus', 'heart'],
                speed: 1.8,
                maxShapesOnScreen: 5,
                scoreTarget: 200,
                timeLimit: 90
            }
        };

        function resizeCanvas() {
            const container = document.getElementById('game-container');
            const infoBarHeight = document.getElementById('info-bar').offsetHeight;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight - infoBarHeight;
            if(gameActive) {
                setupBins();
                draw();
            }
        }
        
        function setupBins() {
            bins = [];
            const levelShapes = difficultySettings[currentLevel].shapes;
            const binWidth = canvas.width / levelShapes.length;
            const binHeight = 100;
            levelShapes.forEach((type, index) => {
                bins.push({
                    type: type, x: index * binWidth, y: canvas.height - binHeight,
                    width: binWidth, height: binHeight,
                });
            });
        }

        function drawBins() {
            bins.forEach((bin) => {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // Matched to dashboard
                ctx.fillRect(bin.x, bin.y, bin.width, bin.height);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.strokeRect(bin.x, bin.y, bin.width, bin.height);
                
                const iconX = bin.x + bin.width / 2;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.font = "bold 16px 'Baloo 2'";
                ctx.textAlign = 'center';
                const shapeName = bin.type.charAt(0).toUpperCase() + bin.type.slice(1);
                ctx.fillText(shapeName, iconX, bin.y + 25);

                ctx.save();
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                drawShape(bin.type, iconX, bin.y + bin.height / 2 + 15, 20);
                ctx.restore();
            });
        }

        function drawPolygon(x, y, size, sides) {
            ctx.moveTo(x + size * Math.cos(0), y + size * Math.sin(0));
            for (let i = 1; i <= sides; i += 1) {
                ctx.lineTo(x + size * Math.cos(i * 2 * Math.PI / sides - Math.PI/2), y + size * Math.sin(i * 2 * Math.PI / sides - Math.PI/2));
            }
        }
        
        function drawShape(type, x, y, size, color = '#FFFFFF') {
            ctx.fillStyle = color;
            ctx.beginPath();
            if (type === 'circle') { ctx.arc(x, y, size, 0, Math.PI * 2); } 
            else if (type === 'square') { ctx.rect(x - size, y - size, size * 2, size * 2); } 
            else if (type === 'triangle') { ctx.moveTo(x, y - size); ctx.lineTo(x - size, y + size); ctx.lineTo(x + size, y + size); } 
            else if (type === 'rectangle') { ctx.rect(x - size * 1.5, y - size * 0.75, size * 3, size * 1.5); } 
            else if (type === 'star') { drawStar(x, y, 5, size, size / 2); }
            else if (type === 'pentagon') { drawPolygon(x, y, size, 5); }
            else if (type === 'hexagon') { drawPolygon(x, y, size, 6); }
            else if (type === 'rhombus') { ctx.moveTo(x, y - size); ctx.lineTo(x + size * 0.8, y); ctx.lineTo(x, y + size); ctx.lineTo(x - size * 0.8, y); }
            else if (type === 'oval') { ctx.ellipse(x, y, size * 1.3, size * 0.9, 0, 0, 2 * Math.PI); }
            else if (type === 'heart') {
                ctx.moveTo(x, y + size * 0.3);
                ctx.bezierCurveTo(x, y, x - size * 0.6, y - size * 0.5, x - size * 0.6, y);
                ctx.bezierCurveTo(x - size * 0.6, y + size * 0.4, x, y + size * 0.8, x, y + size * 0.8);
                ctx.bezierCurveTo(x, y + size * 0.8, x + size * 0.6, y + size * 0.4, x + size * 0.6, y);
                ctx.bezierCurveTo(x + size * 0.6, y - size * 0.5, x, y, x, y + size * 0.3);
            }
            ctx.closePath();
            ctx.fill();
        }

        function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            let step = Math.PI / spikes;
            ctx.moveTo(cx, cy - outerRadius)
            for (let i = 0; i < spikes; i++) {
                ctx.lineTo(cx + Math.cos(rot) * outerRadius, cy + Math.sin(rot) * outerRadius);
                rot += step;
                ctx.lineTo(cx + Math.cos(rot) * innerRadius, cy + Math.sin(rot) * innerRadius);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
        }

        function spawnShape() {
            if (!gameActive) return;
            const { shapes: levelShapes } = difficultySettings[currentLevel];
            const size = 30;
            const type = levelShapes[Math.floor(Math.random() * levelShapes.length)];
            const color = COLORS[Math.floor(Math.random() * COLORS.length)];
            shapes.push({
                type, size, color,
                x: Math.random() * (canvas.width - size * 2) + size, y: -size,
                dx: (Math.random() - 0.5) * 1.5,
                dy: (Math.random() * 0.5 + 0.3) * difficultySettings[currentLevel].speed,
                initialX: 0, initialY: 0
            });
        }

        function updateShapes() {
            shapes.forEach(shape => {
                if (shape === draggingShape) return;
                shape.x += shape.dx; shape.y += shape.dy;
                if (shape.x - shape.size < 0 || shape.x + shape.size > canvas.width) shape.dx *= -1;
                if (shape.y - shape.size > canvas.height) {
                    shape.y = -shape.size;
                    shape.x = Math.random() * (canvas.width - shape.size * 2) + shape.size;
                }
            });
        }
        
        function updateUI() {
            scoreDisplay.textContent = `Score: ${totalScore}`;
            livesDisplay.innerHTML = '&hearts;'.repeat(lives > 0 ? lives : 0);
            timerDisplay.textContent = `Time: ${timeLeft}`;
            if(currentLevel) {
                 levelDisplay.textContent = `Level: ${difficultySettings[currentLevel].name}`;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBins();
            shapes.forEach(shape => drawShape(shape.type, shape.x, shape.y, shape.size, shape.color));

            if (feedback && Date.now() < feedback.endTime) {
                ctx.save();
                ctx.font = "bold 24px 'Baloo 2'";
                ctx.fillStyle = feedback.color;
                ctx.textAlign = 'center'; ctx.strokeStyle = 'black'; ctx.lineWidth = 4;
                const feedbackText = `Correct! ${ALL_SHAPE_FACTS[feedback.type]}`;
                const yPos = Math.min(canvas.height - 120, 50);
                ctx.strokeText(feedbackText, canvas.width / 2, yPos);
                ctx.fillText(feedbackText, canvas.width / 2, yPos);
                ctx.restore();
            } else { feedback = null; }
        }
        
        function gameLoop() {
            if (!gameActive) return;
            updateShapes();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        function handleMouseDown(e) {
            if (!gameActive) return; e.preventDefault();
            const pos = getMousePos(e.touches ? e.touches[0] : e);
            for (let i = shapes.length - 1; i >= 0; i--) {
                const shape = shapes[i];
                if (Math.hypot(pos.x - shape.x, pos.y - shape.y) < shape.size * 1.5) {
                    draggingShape = shape;
                    Object.assign(draggingShape, { initialX: shape.x, initialY: shape.y });
                    offsetX = pos.x - shape.x; offsetY = pos.y - shape.y;
                    canvas.style.cursor = 'grabbing'; break;
                }
            }
        }

        function handleMouseMove(e) {
            if (!draggingShape || !gameActive) return; e.preventDefault();
            const pos = getMousePos(e.touches ? e.touches[0] : e);
            draggingShape.x = pos.x - offsetX; draggingShape.y = pos.y - offsetY;
        }

        function handleMouseUp() {
            if (!draggingShape || !gameActive) return;
            canvas.style.cursor = 'grab';
            let droppedInBin = false;
            for (const bin of bins) {
                if (draggingShape.x > bin.x && draggingShape.x < bin.x + bin.width &&
                    draggingShape.y > bin.y && draggingShape.y < bin.y + bin.height) {
                    if (bin.type === draggingShape.type) {
                        levelScore += 10;
                        totalScore += 10;
                        feedback = { type: draggingShape.type, color: draggingShape.color, endTime: Date.now() + 3000 };
                        shapes = shapes.filter(s => s !== draggingShape);
                        
                        if (levelScore >= difficultySettings[currentLevel].scoreTarget) {
                            advanceLevel();
                        } else {
                            if (shapes.length < difficultySettings[currentLevel].maxShapesOnScreen) {
                                spawnShape();
                            }
                        }

                    } else { 
                        lives--; 
                        draggingShape.x = draggingShape.initialX; 
                        draggingShape.y = draggingShape.initialY; 
                    }
                    droppedInBin = true; break;
                }
            }
            if (!droppedInBin) { draggingShape.x = draggingShape.initialX; draggingShape.y = draggingShape.initialY; }
            draggingShape = null; updateUI();
            if (lives <= 0) { endGame("You ran out of lives!"); }
        }

        function setupNewLevel() {
            levelScore = 0;
            lives = 3;
            shapes = [];
            draggingShape = null;
            gameActive = true;
            modal.style.display = 'none';
            quitButton.style.display = 'block';
            
            timeLeft = difficultySettings[currentLevel].timeLimit;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateUI();
                if (timeLeft <= 0) {
                    endGame("Time's up!");
                }
            }, 1000);

            setupBins();
            updateUI();
            for (let i = 0; i < difficultySettings[currentLevel].maxShapesOnScreen; i++) {
                spawnShape();
            }
            gameLoop();
        }

        function startGame() {
            totalScore = 0;
            currentLevel = 'easy';
            setupNewLevel();
        }
        
        function advanceLevel() {
            gameActive = false;
            clearInterval(timerInterval);
            const nextLevel = (currentLevel === 'easy') ? 'medium' : 'hard';

            if(currentLevel === 'easy' || currentLevel === 'medium'){
                showModal('Hurray!', "You completed this level. Now let's go to the other one.", [
                    {text: 'Next Level', id: 'next-level-btn', action: () => { currentLevel = nextLevel; setupNewLevel(); }}
                ]);
            } else if (currentLevel === 'hard') {
                startCelebration();
            }
        }

        function startCelebration() {
            celebrationContainer.style.display = 'block';
            celebrationContainer.innerHTML = ''; 

            for (let i = 0; i < 100; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.top = '50%';
                sparkle.style.left = '50%';
                sparkle.style.setProperty('--x', `${(Math.random() - 0.5) * 800}px`);
                sparkle.style.setProperty('--y', `${(Math.random() - 0.5) * 800}px`);
                sparkle.style.background = `hsl(${Math.random() * 360}, 100%, 75%)`;
                sparkle.style.animationDelay = `${Math.random() * 0.5}s`;
                celebrationContainer.appendChild(sparkle);
            }

            const pinata = document.createElement('div');
            pinata.className = 'pinata';
            celebrationContainer.appendChild(pinata);

            setTimeout(() => {
                pinata.style.display = 'none'; 
                for (let i = 0; i < 20; i++) {
                    const fragment = document.createElement('div');
                    fragment.className = 'pinata-fragment';
                    fragment.style.setProperty('--x', `${(Math.random() - 0.5) * 600}px`);
                    fragment.style.setProperty('--y', `${(Math.random() - 0.5) * 600}px`);
                    fragment.style.setProperty('--rot', `${(Math.random() - 0.5) * 720}deg`);
                    fragment.style.background = COLORS[Math.floor(Math.random() * COLORS.length)];
                    celebrationContainer.appendChild(fragment);
                }
            }, 1000);

            setTimeout(() => {
                celebrationContainer.style.display = 'none';
                showModal('You Did It!', `You guessed all the shapes! Final Score: ${totalScore}`, [
                    {text: 'Play Again', id: 'play-again-btn', action: showStartScreen}
                ]);
            }, 3000);
        }

        function endGame(reason) {
            gameActive = false;
            clearInterval(timerInterval);
            quitButton.style.display = 'none';
            showModal('Game Over!', `${reason} Your final score is: ${totalScore}`, [
                { text: 'Play Again', id: 'play-again-btn', action: showStartScreen }
            ]);
        }
        
        function quitGame() {
             gameActive = false;
             clearInterval(timerInterval);
             quitButton.style.display = 'none';
             showStartScreen();
        }

        function getMousePos(evt) {
            const rect = canvas.getBoundingClientRect();
            return { x: evt.clientX - rect.left, y: evt.clientY - rect.top };
        }
        
        function showModal(title, text, buttons) {
            modal.innerHTML = `<h1>${title}</h1><p>${text}</p><div id="modal-button-container"></div>`;
            const buttonContainer = modal.querySelector('#modal-button-container');
            buttons.forEach(btnInfo => {
                const button = document.createElement('button');
                button.textContent = btnInfo.text;
                button.id = btnInfo.id;
                button.className = 'modal-button';
                button.onclick = btnInfo.action;
                buttonContainer.appendChild(button);
            });
            modal.style.display = 'flex';
        }
        
        function showStartScreen() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            levelDisplay.textContent = 'Level: -';
            scoreDisplay.textContent = 'Score: 0';
            timerDisplay.textContent = 'Time: --';
            livesDisplay.innerHTML = '&hearts;&hearts;&hearts;';
            showModal('Shapes in Space', 'Learn about geometric shapes as you sort them into the right spaceships!', [
                { text: 'Start Game', id: 'start-game-btn', action: startGame }
            ]);
        }
        
        function createStars() {
            const starContainer = document.getElementById('stars-container');
            if (!starContainer) return;
            starContainer.innerHTML = '';
            for (let i = 0; i < 120; i++) { // Increased star count
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                star.style.animationDuration = `${Math.random() * 2 + 2}s`;
                starContainer.appendChild(star);
            }
        }

        function createSpaceEmojis() {
            const emojiContainer = document.getElementById('emojis-container');
            if (!emojiContainer) return;
            emojiContainer.innerHTML = '';
            const emojis = ['🪐', '🛸', '👽', '☄️', '✨', '🛰️', '🚀']; // Added rocket emoji
            const neonColors = ['#00aaff', '#ff00ff', '#55ff55', '#ffff00', '#ff5555', '#ff9900'];

            for (let i = 0; i < 8; i++) { // Increased emoji count slightly
                const emojiEl = document.createElement('div');
                emojiEl.className = 'space-emoji';
                emojiEl.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                
                const color = neonColors[Math.floor(Math.random() * neonColors.length)];
                emojiEl.style.textShadow = `0 0 7px ${color}, 0 0 15px ${color}`;

                emojiEl.style.fontSize = `${Math.random() * 1.5 + 1}em`;
                emojiEl.style.top = `${Math.random() * 100}%`;
                emojiEl.style.left = `${Math.random() * 100}%`;
                emojiEl.style.animationDelay = `${Math.random() * 10}s`;
                emojiEl.style.animationDuration = `${Math.random() * 20 + 15}s`;
                emojiContainer.appendChild(emojiEl);
            }
        }
        
        function createRockets() {
            const rocketContainer = document.getElementById('rockets-container');
            if (!rocketContainer) return;
            rocketContainer.innerHTML = '';
            const numRockets = 5;

            for (let i = 0; i < numRockets; i++) {
                const rocket = document.createElement('div');
                rocket.className = 'rocket';

                const style = `style-${Math.floor(Math.random() * 3) + 1}`;
                const direction = Math.random() > 0.5 ? 'ltr' : 'rtl';
                
                rocket.classList.add(style, direction);
                
                rocket.style.top = `${Math.random() * 90}%`;
                rocket.style.animationDuration = `${Math.random() * 8 + 8}s`; // 8 to 16 seconds
                rocket.style.animationDelay = `${Math.random() * 10}s`;
                
                rocket.innerHTML = `
                    <div class="body">
                        <div class="window"></div>
                        <div class="fin left"></div>
                        <div class="fin right"></div>
                        <div class="flame"></div>
                    </div>`;
                    
                rocketContainer.appendChild(rocket);
            }
        }


        // Event Listeners
        window.addEventListener('resize', resizeCanvas);
        quitButton.addEventListener('click', quitGame);
        canvas.addEventListener('mousedown', handleMouseDown);
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mouseup', handleMouseUp);
        canvas.addEventListener('touchstart', handleMouseDown, { passive: false });
        canvas.addEventListener('touchmove', handleMouseMove, { passive: false });
        canvas.addEventListener('touchend', handleMouseUp);
        
        // Initial setup
        resizeCanvas();
        createStars();
        createSpaceEmojis();
        createRockets();
        showStartScreen();

    </script>
</body>
</html>

